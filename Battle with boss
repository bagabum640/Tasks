using System;

namespace Task
{
    class Program
    {
        static void Main(string[] args)
        {
            float maxPlayerHealth = 1000;
            float curentPlayerHealth = maxPlayerHealth;
            float playerArmor = 1;
            float maxBossHealth = 5000;
            float curentBossHealth = maxBossHealth;
            float bossArmor = 1;
            int minBossDamage = 85;
            int maxBossDamage = 116;

            float flameArrowDamage = 200;
            float flameArrowBurningDamage = 50;
            int durationOfBurning = 0;

            float ifritDamage = 200;
            float ifritHealth = 100;
            float ifritExplosionDamage = 500;
            int coolDownSummonIfrit = 0;
            int durationSummon = 0;

            float amountOfStolenArmor = 0.3f;
            int durationStolenArmor = 0;

            int coolDownBodySwap = 0;

            float inputDamage;
            float outputDamage = 0;
            float damageOfTime;
            float damageSummon;

            int heightCursorPosition = 12;
            int offsetCursor = 5;

            string usedAbility = null;
            bool isBossAlive = true;
            bool isPlayerAlive = true;
            bool isIfritAlive = false;
            bool isUsedBodySwap = false;
            bool isUsedUnavailableAbility = false;
            ConsoleKeyInfo key;
            Random random = new Random();

            Console.WriteLine("Великий бой пироманта с архидемоном!" +
                                "\n\nЗаклинания:" +
                                $"\n1 - Огненная стрела - наносит {flameArrowDamage} урона огнем и поджигает противника на 5 ходов, нанося {flameArrowBurningDamage} урона огнем каждый ход." +
                                "\n2 - Призыв ифрита - призывает ифрита, сражающегося на вашей стороне 7 ходов. При смерти до истечения срока взрывается." +
                                "\n3 - Кража брони - расплавляет броню соперника понижая его устойчивость к огню и повышая собственную защиту." +
                                "\n4 - Обмен телами - если призванный ифрит жив, то следующая атака направленная против вас, будет получена им.");

            while (isBossAlive && isPlayerAlive)
            {
                Console.WriteLine($"\n\nПиромант: {curentPlayerHealth}/{maxPlayerHealth} очков здоровья\tАрхидемон: {curentBossHealth}/{maxBossHealth} очков здоровья\n\nЛоги боя:\n");

                Console.SetCursorPosition(0, heightCursorPosition);
                key = Console.ReadKey();
                Console.SetCursorPosition(0, heightCursorPosition);

                switch (key.Key)
                {
                    case ConsoleKey.NumPad1:
                        usedAbility = "Огненную стрелу";
                        outputDamage = flameArrowDamage / bossArmor;
                        durationOfBurning = 5;
                        break;

                    case ConsoleKey.NumPad2:
                        usedAbility = "Призыв ифрита";

                        if (coolDownSummonIfrit <= 0)
                        {
                            isIfritAlive = true;
                            ifritHealth = 100;
                            coolDownSummonIfrit = 4;
                            durationSummon = 7;
                        }
                        else
                        {
                            isUsedUnavailableAbility = true;
                        }
                        break;

                    case ConsoleKey.NumPad3:
                        usedAbility = "Кража брони";
                        durationStolenArmor = 3;

                        if (playerArmor == 1)
                        {
                            playerArmor += amountOfStolenArmor;
                            bossArmor -= amountOfStolenArmor;
                        }
                        break;

                    case ConsoleKey.NumPad4:

                        if (coolDownBodySwap <= 0)
                        {
                            usedAbility = "Обмен телами";

                            if (isIfritAlive == true)
                            {
                                coolDownBodySwap = 4;
                                isUsedBodySwap = true;
                            }
                            else
                            {
                                isUsedUnavailableAbility = true;
                            }
                        }
                        else
                        {
                            isUsedUnavailableAbility = true;
                        }
                        break;

                    default:
                        break;
                }

                if (isUsedUnavailableAbility == false)
                {
                    if (durationStolenArmor > 0)
                    {
                        durationStolenArmor--;
                    }
                    else
                    {
                        playerArmor = 1;
                        bossArmor = 1;
                    }

                    if (durationOfBurning > 0)
                    {
                        damageOfTime = flameArrowBurningDamage / bossArmor;
                    }
                    else
                    {
                        damageOfTime = 0;
                    }

                    if (durationSummon > 0)
                    {
                        if (isIfritAlive == true)
                        {
                            damageSummon = ifritDamage / bossArmor;
                            durationSummon--;
                        }
                        else
                        {
                            damageSummon = 0;
                        }
                        coolDownSummonIfrit--;
                    }
                    else
                    {
                        damageSummon = 0;
                        isIfritAlive = false;
                    }

                    if (coolDownBodySwap > 0)
                    {
                        coolDownBodySwap--;
                    }

                    inputDamage = random.Next(minBossDamage, maxBossDamage);

                    if (isUsedBodySwap == true)
                    {
                        ifritHealth -= inputDamage;

                        if (ifritHealth <= 0)
                        {
                            damageSummon += ifritExplosionDamage;
                            Console.WriteLine("Ифрит взрывается и умирает.");
                            offsetCursor++;
                        }
                    }
                    else
                    {
                        curentPlayerHealth -= inputDamage / playerArmor;
                    }

                    curentBossHealth -= (outputDamage + damageOfTime + damageSummon);
                    Console.ForegroundColor = ConsoleColor.Green;

                    switch (usedAbility)
                    {
                        case "Огненную стрелу":
                            Console.WriteLine($"Вы использовали {usedAbility} и нанесли {outputDamage} урона.");
                            break;

                        case "Призыв ифрита":
                        case "Кража брони":
                        case "Обмен телами":
                            Console.WriteLine($"Вы использовали {usedAbility}.");
                            break;

                        default:
                            Console.WriteLine("Пиромант замирает в ужасе!");
                            break;
                    }

                    if (durationOfBurning > 0)
                    {
                        Console.WriteLine($"Демон горит и получает {damageOfTime} урона.");
                        durationOfBurning--;
                    }
                    else
                    {
                        offsetCursor--;
                    }

                    if (isIfritAlive == true)
                    {
                        Console.WriteLine($"Ифрит наносит {damageSummon} урона.");
                    }
                    else
                    {
                        offsetCursor--;
                    }

                    Console.ForegroundColor = ConsoleColor.Red;

                    if (isUsedBodySwap == false)
                        Console.WriteLine($"Демон наносит игроку {inputDamage} урона.");
                    else
                        Console.WriteLine($"Демон наносит ифриту {inputDamage} урона.");
                    Console.ResetColor();

                    usedAbility = null;
                    outputDamage = 0;
                    damageOfTime = 0;

                    if (curentBossHealth <= 0)
                    {
                        isBossAlive = false;
                    }
                    else if (curentPlayerHealth <= 0)
                    {
                        isPlayerAlive = false;
                    }
                    else if (ifritHealth <= 0)
                    {
                        isIfritAlive = false;
                    }
                }
                else if (isUsedUnavailableAbility == true && usedAbility == "Обмен телами")
                {
                    Console.WriteLine("Ифрит не призван. Обмен телами не возможен.");
                    offsetCursor--;
                    offsetCursor--;
                }
                else
                {
                    Console.WriteLine($"Способность перезаряжается! Используйте другое заклинание!");
                    offsetCursor--;
                    offsetCursor--;
                    offsetCursor--;
                }
                isUsedBodySwap = false;
                isUsedUnavailableAbility = false;
                heightCursorPosition += offsetCursor;
                offsetCursor = 5;
                Console.SetCursorPosition(0, 7);
            }

            Console.Clear();

            if (isBossAlive == false)
            {
                Console.ForegroundColor = ConsoleColor.Green;
                Console.WriteLine("Демон мертв! Да здравствует пиромант!");
            }
            else if (isPlayerAlive == false)
            {
                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine("Пиромант мертв! Кто следующий?");
            }
        }
    }
}
